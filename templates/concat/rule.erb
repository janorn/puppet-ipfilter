# Rule <%= @name %>
<% if scope.lookupvar('array_source').length > 0 -%>
<% scope.lookupvar('array_source').each do |s| -%>
<% if scope.lookupvar('array_destination').length > 0 -%>
<% scope.lookupvar('array_destination').each do |d| -%>
<%= @action %> <%= @direction %> quick <%= scope.lookupvar('true_protocol') %> from <%= s %> to <%= d %> <%= scope.lookupvar('true_port') %><%= @state %>
<% end -%>
<% else -%>
<%# No destination ip -%>
<%= @action %> <%= @direction %> quick <%= scope.lookupvar('true_protocol') %> from <%= s %> to any <%= scope.lookupvar('true_port') %><%= @state %>
<% end -%>
<% end -%>
<% else -%>
<%# No source ip -%>
<%= @action %> <%= @direction %> quick <%= scope.lookupvar('true_protocol') %> all
<% end -%>

